syntax = "proto3";

option java_package = "com.soulfiremc.grpc.generated";
option java_multiple_files = true;

package soulfire.v1;

import "soulfire/common.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";

message BotInfoRequest {
  string instance_id = 1;
  string bot_id = 2;
}

message BotListRequest {
  string instance_id = 1;
}

message BotListEntry {
  string profile_id = 1;
  bool is_online = 2;
  optional BotLiveState live_state = 3;
}

message BotListResponse {
  repeated BotListEntry bots = 1;
}

// Represents an item in an inventory slot
message InventorySlot {
  int32 slot = 1;
  string item_id = 2;  // e.g., "minecraft:diamond_sword"
  int32 count = 3;
  optional string display_name = 4;  // Custom name if present
}

message BotLiveState {
  double x = 1;
  double y = 2;
  double z = 3;
  float xRot = 4;
  float yRot = 5;

  // Health and food
  float health = 6;
  float max_health = 7;
  int32 food_level = 8;
  float saturation_level = 9;

  // Inventory (only non-empty slots)
  repeated InventorySlot inventory = 10;
  int32 selected_hotbar_slot = 11;

  // World info
  string dimension = 12;  // e.g., "minecraft:overworld"

  // Experience
  int32 experience_level = 13;
  float experience_progress = 14;  // 0.0 to 1.0

  // Skin texture hash for avatar rendering (e.g., "abc123def456...")
  // Use with https://mc-heads.net/body/<hash> for full body render
  optional string skin_texture_hash = 15;

  // Game mode (survival, creative, adventure, spectator)
  GameMode game_mode = 16;
}

// Minecraft game modes
enum GameMode {
  GAME_MODE_UNSPECIFIED = 0;
  GAME_MODE_SURVIVAL = 1;
  GAME_MODE_CREATIVE = 2;
  GAME_MODE_ADVENTURE = 3;
  GAME_MODE_SPECTATOR = 4;
}

message BotInfoResponse {
  optional BotLiveState live_state = 2;
}

// Granular config entry update (single key-value)
message BotUpdateConfigEntryRequest {
  string instance_id = 1;
  string bot_id = 2;
  string namespace = 3;
  string key = 4;
  google.protobuf.Value value = 5;
}

message BotUpdateConfigEntryResponse {
}

// POV Rendering
message BotRenderPovRequest {
  string instance_id = 1;
  string bot_id = 2;
  int32 width = 3;   // Image width (default 854)
  int32 height = 4;  // Image height (default 480)
}

message BotRenderPovResponse {
  string image_base64 = 1;  // Base64 encoded PNG image
}

// Inventory Actions - click on a slot to interact with it
message BotInventoryClickRequest {
  string instance_id = 1;
  string bot_id = 2;
  int32 slot = 3;           // Slot index (-999 for outside/drop)
  ClickType click_type = 4;
  int32 hotbar_slot = 5;    // For SWAP_HOTBAR action (0-8)
}

enum ClickType {
  CLICK_TYPE_UNSPECIFIED = 0;
  LEFT_CLICK = 1;           // Pick up / place stack
  RIGHT_CLICK = 2;          // Pick up half / place one
  SHIFT_LEFT_CLICK = 3;     // Quick move to other inventory section
  DROP_ONE = 4;             // Drop one item (Q key on slot)
  DROP_ALL = 5;             // Drop entire stack (Ctrl+Q on slot)
  SWAP_HOTBAR = 6;          // Swap slot with hotbar (1-9 keys)
  MIDDLE_CLICK = 7;         // Clone item (creative mode)
}

message BotInventoryClickResponse {
  bool success = 1;
  optional string error = 2;
}

// Get current inventory state including carried item
message BotInventoryStateRequest {
  string instance_id = 1;
  string bot_id = 2;
}

// Describes how a region of slots should be rendered
enum SlotRegionType {
  SLOT_REGION_NORMAL = 0;      // Regular interactive slots
  SLOT_REGION_OUTPUT = 1;      // Output-only (crafting result, furnace output)
  SLOT_REGION_DISPLAY = 2;     // Display-only (lectern book, some special slots)
  SLOT_REGION_HOTBAR = 3;      // Player hotbar (show selection indicator)
  SLOT_REGION_ARMOR = 4;       // Armor slots (show armor icons as placeholder)
}

// A group of slots that should be rendered together
message SlotRegion {
  string id = 1;           // Unique ID, e.g., "container", "player_hotbar"
  string label = 2;        // Display label, e.g., "Chest", "Hotbar"
  int32 start_index = 3;   // First slot index in this region
  int32 slot_count = 4;    // Number of slots in this region
  int32 columns = 5;       // Grid columns for layout
  SlotRegionType type = 6; // Affects rendering behavior
}

// A clickable button in a container (e.g., enchantment options, stonecutter recipes)
message ContainerButton {
  int32 button_id = 1;              // Button ID to send when clicking
  string label = 2;                 // Display label (e.g., "Silk Touch I")
  optional string icon_item_id = 3; // Item ID for icon (e.g., "minecraft:stone_bricks")
  optional string description = 4;  // Tooltip/description text
  bool disabled = 5;                // Whether the button is currently disabled
  bool selected = 6;                // Whether this button is currently selected
}

// Text input field description for containers like anvil
message ContainerTextInput {
  string id = 1;           // Field identifier (e.g., "item_name" for anvil)
  string label = 2;        // Display label
  string current_value = 3; // Current text value
  int32 max_length = 4;    // Maximum allowed characters (0 = no limit)
  string placeholder = 5;  // Placeholder text
}

// Book page for lectern display
message BookPage {
  int32 page_number = 1;   // 0-indexed page number
  string content = 2;      // Page content (may contain formatting codes)
}

// Describes the layout of an open container
message ContainerLayout {
  string title = 1;                  // Container title/name
  repeated SlotRegion regions = 2;   // Ordered list of slot regions to render
  int32 total_slots = 3;             // Total number of slots
  repeated ContainerButton buttons = 4; // Available action buttons (stonecutter recipes, enchants, etc.)
  string container_type = 5;         // Container type identifier for client-specific rendering
  repeated ContainerTextInput text_inputs = 6; // Text input fields (anvil rename, etc.)
  repeated BookPage book_pages = 7;  // Book pages for lectern
  int32 current_book_page = 8;       // Current page being displayed (lectern)
}

message BotInventoryStateResponse {
  ContainerLayout layout = 1;             // Container layout information
  repeated InventorySlot slots = 2;       // All inventory slots with items
  optional InventorySlot carried_item = 3; // Item currently on cursor
  int32 selected_hotbar_slot = 4;
}

// Close current container
message BotCloseContainerRequest {
  string instance_id = 1;
  string bot_id = 2;
}

message BotCloseContainerResponse {
  bool success = 1;
}

// Open player inventory
message BotOpenInventoryRequest {
  string instance_id = 1;
  string bot_id = 2;
}

message BotOpenInventoryResponse {
  bool success = 1;
}

// Mouse click actions - simulates left/right mouse button press
message BotMouseClickRequest {
  string instance_id = 1;
  string bot_id = 2;
  MouseButton button = 3;
}

enum MouseButton {
  MOUSE_BUTTON_UNSPECIFIED = 0;
  LEFT_BUTTON = 1;   // Attack entity / start breaking block
  RIGHT_BUTTON = 2;  // Use item / interact with entity or block
}

message BotMouseClickResponse {
  bool success = 1;
  optional string error = 2;
}

// Click a container button (enchantment selection, stonecutter recipe, etc.)
message BotContainerButtonClickRequest {
  string instance_id = 1;
  string bot_id = 2;
  int32 button_id = 3;
}

message BotContainerButtonClickResponse {
  bool success = 1;
  optional string error = 2;
}

// Set text input in a container (anvil rename, etc.)
message BotSetContainerTextRequest {
  string instance_id = 1;
  string bot_id = 2;
  string field_id = 3;    // Which field to set (e.g., "item_name")
  string text = 4;        // The text value to set
}

message BotSetContainerTextResponse {
  bool success = 1;
  optional string error = 2;
}

// Change the selected hotbar slot (0-8)
message BotSetHotbarSlotRequest {
  string instance_id = 1;
  string bot_id = 2;
  int32 slot = 3;           // Hotbar slot index (0-8)
}

message BotSetHotbarSlotResponse {
  bool success = 1;
  optional string error = 2;
}

// ============================================================================
// Movement Control Messages
// Control bot movement (WASD, jump, sneak, sprint)
// ============================================================================

// Movement state - each field is optional to allow partial updates
message BotSetMovementStateRequest {
  string instance_id = 1;
  string bot_id = 2;
  optional bool forward = 3;    // W key - move forward
  optional bool backward = 4;   // S key - move backward
  optional bool left = 5;       // A key - strafe left
  optional bool right = 6;      // D key - strafe right
  optional bool jump = 7;       // Space - jump
  optional bool sneak = 8;      // Shift - sneak
  optional bool sprint = 9;     // Ctrl - sprint
}

message BotSetMovementStateResponse {
  bool success = 1;
  optional string error = 2;
}

// Reset all movement to stopped state
message BotResetMovementRequest {
  string instance_id = 1;
  string bot_id = 2;
}

message BotResetMovementResponse {
  bool success = 1;
  optional string error = 2;
}

// ============================================================================
// Rotation Control Messages
// Control bot view direction (yaw/pitch)
// ============================================================================

// Set absolute rotation
message BotSetRotationRequest {
  string instance_id = 1;
  string bot_id = 2;
  float yaw = 3;    // Horizontal rotation (-180 to 180, 0 = south)
  float pitch = 4;  // Vertical rotation (-90 to 90, negative = up)
}

message BotSetRotationResponse {
  bool success = 1;
  optional string error = 2;
}

// ============================================================================
// Server Dialog Messages (Minecraft 1.21.6+)
// Dialogs are server-sent UI screens that can display information and gather input
// ============================================================================

// Dialog types matching Minecraft's registry
enum DialogType {
  DIALOG_TYPE_UNSPECIFIED = 0;
  DIALOG_TYPE_NOTICE = 1;           // Single action button in footer
  DIALOG_TYPE_CONFIRMATION = 2;     // Yes/No buttons in footer
  DIALOG_TYPE_MULTI_ACTION = 3;     // Scrollable list of action buttons
  DIALOG_TYPE_SERVER_LINKS = 4;     // Server links display
  DIALOG_TYPE_DIALOG_LIST = 5;      // Buttons linking to other dialogs
}

// Body element types
message DialogBodyElement {
  oneof element {
    DialogPlainMessage plain_message = 1;
    DialogItem item = 2;
  }
}

message DialogPlainMessage {
  string contents = 1;     // Text content (JSON text component)
  int32 width = 2;         // Width (1-1024, default 200)
}

message DialogItem {
  string item_id = 1;              // e.g., "minecraft:diamond"
  int32 count = 2;                 // Item count
  optional string description = 3; // Optional description text
  bool show_decoration = 4;        // Show item frame decoration (default true)
  bool show_tooltip = 5;           // Show item tooltip on hover (default true)
  int32 width = 6;                 // Display width (1-256, default 16)
  int32 height = 7;                // Display height (1-256, default 16)
}

// Input control types
message DialogInput {
  oneof input {
    DialogTextInput text = 1;
    DialogBooleanInput boolean = 2;
    DialogSingleOptionInput single_option = 3;
    DialogNumberRangeInput number_range = 4;
  }
}

message DialogTextInput {
  string key = 1;              // Identifier for submission
  string label = 2;            // Display label
  int32 width = 3;             // Width (1-1024, default 200)
  bool label_visible = 4;      // Show label (default true)
  string initial = 5;          // Default value
  int32 max_length = 6;        // Max chars (default 32)
  bool multiline = 7;          // Allow multiline input
  int32 multiline_max_lines = 8; // Max lines for multiline
  int32 multiline_height = 9;  // Height for multiline
}

message DialogBooleanInput {
  string key = 1;              // Identifier for submission
  string label = 2;            // Display label
  bool initial = 3;            // Default value (default false)
  string on_true = 4;          // Value when checked (default "true")
  string on_false = 5;         // Value when unchecked (default "false")
}

message DialogSingleOptionInput {
  string key = 1;              // Identifier for submission
  string label = 2;            // Display label
  bool label_visible = 3;      // Show label (default true)
  int32 width = 4;             // Width (1-1024, default 200)
  repeated DialogOption options = 5; // Available options
  string initial_option_id = 6; // Initially selected option ID
}

message DialogOption {
  string id = 1;               // Option identifier
  string display = 2;          // Display text (optional, uses id if not set)
}

message DialogNumberRangeInput {
  string key = 1;              // Identifier for submission
  string label = 2;            // Display label
  string label_format = 3;     // Translation key for label format
  int32 width = 4;             // Width (1-1024, default 200)
  double start = 5;            // Minimum value
  double end = 6;              // Maximum value
  double step = 7;             // Step size (optional)
  double initial = 8;          // Default value
}

// Action types for buttons
message DialogAction {
  oneof action {
    DialogOpenUrlAction open_url = 1;
    DialogRunCommandAction run_command = 2;
    DialogSuggestCommandAction suggest_command = 3;
    DialogCopyToClipboardAction copy_to_clipboard = 4;
    DialogShowDialogAction show_dialog = 5;
    DialogCustomAction custom = 6;
    DialogDynamicRunCommandAction dynamic_run_command = 7;
    DialogDynamicCustomAction dynamic_custom = 8;
  }
}

message DialogOpenUrlAction {
  string url = 1;
}

message DialogRunCommandAction {
  string command = 1;
}

message DialogSuggestCommandAction {
  string command = 1;
}

message DialogCopyToClipboardAction {
  string value = 1;
}

message DialogShowDialogAction {
  string dialog_id = 1;        // Dialog ID to show (or inline definition)
}

message DialogCustomAction {
  string id = 1;               // Custom action identifier
  string payload = 2;          // Optional JSON payload
}

message DialogDynamicRunCommandAction {
  string template = 1;         // Macro template with input placeholders
}

message DialogDynamicCustomAction {
  string id = 1;               // Custom action identifier
  string additions = 2;        // Optional NBT additions as JSON
}

// Button structure used across dialog types
message DialogButton {
  string label = 1;            // Button text (JSON text component)
  optional string tooltip = 2; // Tooltip on hover
  int32 width = 3;             // Button width (1-1024, default 150)
  optional DialogAction action = 4; // Action when clicked
}

// After-action behavior
enum DialogAfterAction {
  DIALOG_AFTER_ACTION_UNSPECIFIED = 0;
  DIALOG_AFTER_ACTION_CLOSE = 1;           // Close dialog (default)
  DIALOG_AFTER_ACTION_NONE = 2;            // Keep dialog open
  DIALOG_AFTER_ACTION_WAIT_FOR_RESPONSE = 3; // Show waiting screen
}

// Complete dialog definition
message ServerDialog {
  string id = 1;                          // Dialog ID (from server)
  DialogType type = 2;                    // Dialog type
  string title = 3;                       // Dialog title (JSON text component)
  optional string external_title = 4;     // Button label when shown as external button
  repeated DialogBodyElement body = 5;    // Body elements
  repeated DialogInput inputs = 6;        // Input controls
  bool can_close_with_escape = 7;         // Allow ESC to close (default true)
  bool pause = 8;                         // Pause game in singleplayer (default true)
  DialogAfterAction after_action = 9;     // Behavior after action

  // Type-specific fields
  optional DialogButton action = 10;      // For notice type - single action
  optional DialogButton yes = 11;         // For confirmation type
  optional DialogButton no = 12;          // For confirmation type
  repeated DialogButton actions = 13;     // For multi_action type
  int32 columns = 14;                     // For multi_action/dialog_list (default 2)
  optional DialogButton exit_action = 15; // For multi_action/server_links/dialog_list
  int32 button_width = 16;                // For server_links/dialog_list (default 150)
}

// Get current dialog state
message BotGetDialogRequest {
  string instance_id = 1;
  string bot_id = 2;
}

message BotGetDialogResponse {
  optional ServerDialog dialog = 1;       // Current dialog, or null if none
}

// Submit dialog response (for dialogs with inputs)
message BotSubmitDialogRequest {
  string instance_id = 1;
  string bot_id = 2;
  map<string, string> input_values = 3;   // Input key -> value mappings
}

message BotSubmitDialogResponse {
  bool success = 1;
  optional string error = 2;
}

// Click a dialog button
message BotClickDialogButtonRequest {
  string instance_id = 1;
  string bot_id = 2;
  int32 button_index = 3;                 // Index of button to click (-1 for close/escape)
}

message BotClickDialogButtonResponse {
  bool success = 1;
  optional string error = 2;
}

// Close/dismiss current dialog
message BotCloseDialogRequest {
  string instance_id = 1;
  string bot_id = 2;
}

message BotCloseDialogResponse {
  bool success = 1;
  optional string error = 2;
}

service BotService {
  rpc GetBotList (BotListRequest) returns (BotListResponse) {}
  rpc GetBotInfo (BotInfoRequest) returns (BotInfoResponse) {}
  // Granular update for individual config entries
  rpc UpdateBotConfigEntry (BotUpdateConfigEntryRequest) returns (BotUpdateConfigEntryResponse) {}
  // Render the bot's point of view using software rendering
  rpc RenderBotPov (BotRenderPovRequest) returns (BotRenderPovResponse) {}
  // Inventory management
  rpc ClickInventorySlot (BotInventoryClickRequest) returns (BotInventoryClickResponse) {}
  rpc GetInventoryState (BotInventoryStateRequest) returns (BotInventoryStateResponse) {}
  rpc CloseContainer (BotCloseContainerRequest) returns (BotCloseContainerResponse) {}
  rpc OpenInventory (BotOpenInventoryRequest) returns (BotOpenInventoryResponse) {}
  // Mouse click actions
  rpc MouseClick (BotMouseClickRequest) returns (BotMouseClickResponse) {}
  // Container button actions (enchanting, stonecutter, etc.)
  rpc ClickContainerButton (BotContainerButtonClickRequest) returns (BotContainerButtonClickResponse) {}
  // Set text input in container (anvil rename, etc.)
  rpc SetContainerText (BotSetContainerTextRequest) returns (BotSetContainerTextResponse) {}
  // Hotbar slot selection
  rpc SetHotbarSlot (BotSetHotbarSlotRequest) returns (BotSetHotbarSlotResponse) {}
  // Movement control (WASD, jump, sneak, sprint)
  rpc SetMovementState (BotSetMovementStateRequest) returns (BotSetMovementStateResponse) {}
  rpc ResetMovement (BotResetMovementRequest) returns (BotResetMovementResponse) {}
  // Rotation control (look direction)
  rpc SetRotation (BotSetRotationRequest) returns (BotSetRotationResponse) {}
  // Server dialog management (Minecraft 1.21.6+)
  rpc GetDialog (BotGetDialogRequest) returns (BotGetDialogResponse) {}
  rpc SubmitDialog (BotSubmitDialogRequest) returns (BotSubmitDialogResponse) {}
  rpc ClickDialogButton (BotClickDialogButtonRequest) returns (BotClickDialogButtonResponse) {}
  rpc CloseDialog (BotCloseDialogRequest) returns (BotCloseDialogResponse) {}
}
