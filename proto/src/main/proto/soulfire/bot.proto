syntax = "proto3";

option java_package = "com.soulfiremc.grpc.generated";
option java_multiple_files = true;

package soulfire.v1;

import "soulfire/common.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";

message BotConfig {
  repeated SettingsNamespace settings = 1;
}

message BotInfoRequest {
  string instance_id = 1;
  string bot_id = 2;
}

message BotListRequest {
  string instance_id = 1;
}

message BotListEntry {
  string profile_id = 1;
  bool is_online = 2;
  optional BotLiveState live_state = 3;
}

message BotListResponse {
  repeated BotListEntry bots = 1;
}

// Represents an item in an inventory slot
message InventorySlot {
  int32 slot = 1;
  string item_id = 2;  // e.g., "minecraft:diamond_sword"
  int32 count = 3;
  optional string display_name = 4;  // Custom name if present
}

message BotLiveState {
  double x = 1;
  double y = 2;
  double z = 3;
  float xRot = 4;
  float yRot = 5;

  // Health and food
  float health = 6;
  float max_health = 7;
  int32 food_level = 8;
  float saturation_level = 9;

  // Inventory (only non-empty slots)
  repeated InventorySlot inventory = 10;
  int32 selected_hotbar_slot = 11;

  // World info
  string dimension = 12;  // e.g., "minecraft:overworld"

  // Experience
  int32 experience_level = 13;
  float experience_progress = 14;  // 0.0 to 1.0

  // Skin texture hash for avatar rendering (e.g., "abc123def456...")
  // Use with https://mc-heads.net/body/<hash> for full body render
  optional string skin_texture_hash = 15;
}

message BotInfoResponse {
  BotConfig config = 1;
  optional BotLiveState live_state = 2;
}

message BotUpdateConfigRequest {
  string instance_id = 1;
  string bot_id = 2;
  BotConfig config = 3;
}

message BotUpdateConfigResponse {
}

// Granular config entry update (single key-value)
message BotUpdateConfigEntryRequest {
  string instance_id = 1;
  string bot_id = 2;
  string namespace = 3;
  string key = 4;
  google.protobuf.Value value = 5;
}

message BotUpdateConfigEntryResponse {
}

// POV Rendering
message BotRenderPovRequest {
  string instance_id = 1;
  string bot_id = 2;
  int32 width = 3;   // Image width (default 854)
  int32 height = 4;  // Image height (default 480)
}

message BotRenderPovResponse {
  string image_base64 = 1;  // Base64 encoded PNG image
}

// Inventory Actions - click on a slot to interact with it
message BotInventoryClickRequest {
  string instance_id = 1;
  string bot_id = 2;
  int32 slot = 3;           // Slot index (-999 for outside/drop)
  ClickType click_type = 4;
  int32 hotbar_slot = 5;    // For SWAP_HOTBAR action (0-8)
}

enum ClickType {
  CLICK_TYPE_UNSPECIFIED = 0;
  LEFT_CLICK = 1;           // Pick up / place stack
  RIGHT_CLICK = 2;          // Pick up half / place one
  SHIFT_LEFT_CLICK = 3;     // Quick move to other inventory section
  DROP_ONE = 4;             // Drop one item (Q key on slot)
  DROP_ALL = 5;             // Drop entire stack (Ctrl+Q on slot)
  SWAP_HOTBAR = 6;          // Swap slot with hotbar (1-9 keys)
  MIDDLE_CLICK = 7;         // Clone item (creative mode)
}

message BotInventoryClickResponse {
  bool success = 1;
  optional string error = 2;
}

// Get current inventory state including carried item
message BotInventoryStateRequest {
  string instance_id = 1;
  string bot_id = 2;
}

// Describes how a region of slots should be rendered
enum SlotRegionType {
  SLOT_REGION_NORMAL = 0;      // Regular interactive slots
  SLOT_REGION_OUTPUT = 1;      // Output-only (crafting result, furnace output)
  SLOT_REGION_DISPLAY = 2;     // Display-only (lectern book, some special slots)
  SLOT_REGION_HOTBAR = 3;      // Player hotbar (show selection indicator)
  SLOT_REGION_ARMOR = 4;       // Armor slots (show armor icons as placeholder)
}

// A group of slots that should be rendered together
message SlotRegion {
  string id = 1;           // Unique ID, e.g., "container", "player_hotbar"
  string label = 2;        // Display label, e.g., "Chest", "Hotbar"
  int32 start_index = 3;   // First slot index in this region
  int32 slot_count = 4;    // Number of slots in this region
  int32 columns = 5;       // Grid columns for layout
  SlotRegionType type = 6; // Affects rendering behavior
}

// A clickable button in a container (e.g., enchantment options, stonecutter recipes)
message ContainerButton {
  int32 button_id = 1;              // Button ID to send when clicking
  string label = 2;                 // Display label (e.g., "Silk Touch I")
  optional string icon_item_id = 3; // Item ID for icon (e.g., "minecraft:stone_bricks")
  optional string description = 4;  // Tooltip/description text
  bool disabled = 5;                // Whether the button is currently disabled
  bool selected = 6;                // Whether this button is currently selected
}

// Text input field description for containers like anvil
message ContainerTextInput {
  string id = 1;           // Field identifier (e.g., "item_name" for anvil)
  string label = 2;        // Display label
  string current_value = 3; // Current text value
  int32 max_length = 4;    // Maximum allowed characters (0 = no limit)
  string placeholder = 5;  // Placeholder text
}

// Book page for lectern display
message BookPage {
  int32 page_number = 1;   // 0-indexed page number
  string content = 2;      // Page content (may contain formatting codes)
}

// Describes the layout of an open container
message ContainerLayout {
  string title = 1;                  // Container title/name
  repeated SlotRegion regions = 2;   // Ordered list of slot regions to render
  int32 total_slots = 3;             // Total number of slots
  repeated ContainerButton buttons = 4; // Available action buttons (stonecutter recipes, enchants, etc.)
  string container_type = 5;         // Container type identifier for client-specific rendering
  repeated ContainerTextInput text_inputs = 6; // Text input fields (anvil rename, etc.)
  repeated BookPage book_pages = 7;  // Book pages for lectern
  int32 current_book_page = 8;       // Current page being displayed (lectern)
}

message BotInventoryStateResponse {
  ContainerLayout layout = 1;             // Container layout information
  repeated InventorySlot slots = 2;       // All inventory slots with items
  optional InventorySlot carried_item = 3; // Item currently on cursor
  int32 selected_hotbar_slot = 4;
}

// Close current container
message BotCloseContainerRequest {
  string instance_id = 1;
  string bot_id = 2;
}

message BotCloseContainerResponse {
  bool success = 1;
}

// Open player inventory
message BotOpenInventoryRequest {
  string instance_id = 1;
  string bot_id = 2;
}

message BotOpenInventoryResponse {
  bool success = 1;
}

// Mouse click actions - simulates left/right mouse button press
message BotMouseClickRequest {
  string instance_id = 1;
  string bot_id = 2;
  MouseButton button = 3;
}

enum MouseButton {
  MOUSE_BUTTON_UNSPECIFIED = 0;
  LEFT_BUTTON = 1;   // Attack entity / start breaking block
  RIGHT_BUTTON = 2;  // Use item / interact with entity or block
}

message BotMouseClickResponse {
  bool success = 1;
  optional string error = 2;
}

// Click a container button (enchantment selection, stonecutter recipe, etc.)
message BotContainerButtonClickRequest {
  string instance_id = 1;
  string bot_id = 2;
  int32 button_id = 3;
}

message BotContainerButtonClickResponse {
  bool success = 1;
  optional string error = 2;
}

// Set text input in a container (anvil rename, etc.)
message BotSetContainerTextRequest {
  string instance_id = 1;
  string bot_id = 2;
  string field_id = 3;    // Which field to set (e.g., "item_name")
  string text = 4;        // The text value to set
}

message BotSetContainerTextResponse {
  bool success = 1;
  optional string error = 2;
}

service BotService {
  rpc GetBotList (BotListRequest) returns (BotListResponse) {}
  rpc GetBotInfo (BotInfoRequest) returns (BotInfoResponse) {}
  // Used only for profile import - sends entire config
  rpc UpdateBotConfig (BotUpdateConfigRequest) returns (BotUpdateConfigResponse) {}
  // Granular update for individual config entries
  rpc UpdateBotConfigEntry (BotUpdateConfigEntryRequest) returns (BotUpdateConfigEntryResponse) {}
  // Render the bot's point of view using software rendering
  rpc RenderBotPov (BotRenderPovRequest) returns (BotRenderPovResponse) {}
  // Inventory management
  rpc ClickInventorySlot (BotInventoryClickRequest) returns (BotInventoryClickResponse) {}
  rpc GetInventoryState (BotInventoryStateRequest) returns (BotInventoryStateResponse) {}
  rpc CloseContainer (BotCloseContainerRequest) returns (BotCloseContainerResponse) {}
  rpc OpenInventory (BotOpenInventoryRequest) returns (BotOpenInventoryResponse) {}
  // Mouse click actions
  rpc MouseClick (BotMouseClickRequest) returns (BotMouseClickResponse) {}
  // Container button actions (enchanting, stonecutter, etc.)
  rpc ClickContainerButton (BotContainerButtonClickRequest) returns (BotContainerButtonClickResponse) {}
  // Set text input in container (anvil rename, etc.)
  rpc SetContainerText (BotSetContainerTextRequest) returns (BotSetContainerTextResponse) {}
}
